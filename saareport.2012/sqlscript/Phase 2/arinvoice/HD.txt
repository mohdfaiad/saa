/******************************************************************************/
/****              Generated by IBExpert 17/12/2007 14:52:26               ****/
/******************************************************************************/

SET SQL DIALECT 3;

SET NAMES NONE;



/******************************************************************************/
/****                                Tables                                ****/
/******************************************************************************/

CREATE TABLE AR_INVOICE_HD (
    DEBTOR_ACCT     VARCHAR10 NOT NULL,
    DOC_NO          VARCHAR15 NOT NULL,
    DOC_DATE        DDATE NOT NULL,
    TRX_TYPE        VARCHAR2 NOT NULL,
    TAX_INV_NO      VARCHAR15,
    TAX_INV_DATE    DDATE,
    DEBT_NAME       VARCHAR60,
    REMARK          VARCHAR(255),
    STATUS          VARCHAR(1) DEFAULT 'N',
    RECEIPT_STATUS  VARCHAR(1) DEFAULT 'N',
    DUE_DATE        TIMESTAMP,
    CREDIT_TERM     SMALLINT,
    NO_OF_PRINT     SMALLINT DEFAULT 0,
    UPDATE_USER     VARCHAR(30),
    UPDATE_DATE     TIMESTAMP
);





/******************************************************************************/
/****                             Primary Keys                             ****/
/******************************************************************************/

ALTER TABLE AR_INVOICE_HD ADD PRIMARY KEY (DEBTOR_ACCT, DOC_NO, DOC_DATE, TRX_TYPE);


/******************************************************************************/
/****                               Indices                                ****/
/******************************************************************************/

CREATE UNIQUE INDEX XPKAR_INVOICE_HD ON AR_INVOICE_HD (DEBTOR_ACCT, DOC_NO, DOC_DATE, TRX_TYPE);


/******************************************************************************/
/****                               Triggers                               ****/
/******************************************************************************/


SET TERM ^ ;




/* Trigger: REPL$2_11_D_1_1 */
CREATE TRIGGER REPL$2_11_D_1_1 FOR AR_INVOICE_HD
INACTIVE AFTER DELETE POSITION 32760
AS
BEGIN
IF (USER <> 'REPL') THEN BEGIN
  INSERT INTO REPL_LOG(REPLNO,PUBDBNO,SUBDBNO,RELATIONNO,REPTYPE,OLDKEY)
  VALUES (1,1,2,11,'D',OLD.DEBTOR_ACCT||''||OLD.DOC_NO||''||OLD.DOC_DATE||''||OLD.TRX_TYPE);END
END
^

/* Trigger: REPL$2_11_I_1_1 */
CREATE TRIGGER REPL$2_11_I_1_1 FOR AR_INVOICE_HD
INACTIVE AFTER INSERT POSITION 32760
AS
BEGIN
IF (USER <> 'REPL') THEN BEGIN
  INSERT INTO REPL_LOG(REPLNO,PUBDBNO,SUBDBNO,RELATIONNO,REPTYPE,NEWKEY)
  VALUES (1,1,2,11,'I',NEW.DEBTOR_ACCT||''||NEW.DOC_NO||''||NEW.DOC_DATE||''||NEW.TRX_TYPE);END
END
^

/* Trigger: REPL$2_11_U_1_1 */
CREATE TRIGGER REPL$2_11_U_1_1 FOR AR_INVOICE_HD
INACTIVE AFTER UPDATE POSITION 32760
AS
BEGIN
IF (USER <> 'REPL') THEN BEGIN
  INSERT INTO REPL_LOG(REPLNO,PUBDBNO,SUBDBNO,RELATIONNO,REPTYPE,OLDKEY,NEWKEY)
  VALUES (1,1,2,11,'U',OLD.DEBTOR_ACCT||''||OLD.DOC_NO||''||OLD.DOC_DATE||''||OLD.TRX_TYPE,NEW.DEBTOR_ACCT||''||NEW.DOC_NO||''||NEW.DOC_DATE||''||NEW.TRX_TYPE);END
END
^

/* Trigger: TD_AR_INVOICE_HD */
CREATE TRIGGER TD_AR_INVOICE_HD FOR AR_INVOICE_HD
ACTIVE AFTER DELETE POSITION 0
AS
  /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
  /* DELETE trigger on AR_INVOICE_HD */
DECLARE VARIABLE numrows INTEGER;
BEGIN
    /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
    /* AR_INVOICE_HD R/65 AR_INVOICE_DT ON PARENT DELETE RESTRICT */
  delete
      from AR_INVOICE_DT
      where
        /*  AR_INVOICE_DT.DEBTOR_ACCT = OLD.DEBTOR_ACCT and
            AR_INVOICE_DT.DOC_NO = OLD.DOC_NO and
            AR_INVOICE_DT.DOC_DATE = OLD.DOC_DATE and
            AR_INVOICE_DT.TRX_TYPE = OLD.TRX_TYPE */
        AR_INVOICE_DT.DEBTOR_ACCT = OLD.DEBTOR_ACCT and
        AR_INVOICE_DT.DOC_NO = OLD.DOC_NO and
        AR_INVOICE_DT.DOC_DATE = OLD.DOC_DATE and
        AR_INVOICE_DT.TRX_TYPE = OLD.TRX_TYPE ;


  /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
END
^

/* Trigger: TU_AR_INVOICE_HD */
CREATE TRIGGER TU_AR_INVOICE_HD FOR AR_INVOICE_HD
ACTIVE AFTER UPDATE POSITION 0
AS
  /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
  /* UPDATE trigger on AR_INVOICE_HD */
DECLARE VARIABLE numrows INTEGER;
BEGIN
  /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
  /* AR_INVOICE_HD R/65 AR_INVOICE_DT ON PARENT UPDATE CASCADE */
  IF
    /* OLD.DEBTOR_ACCT <> NEW.DEBTOR_ACCT or 
       OLD.DOC_NO <> NEW.DOC_NO or 
       OLD.DOC_DATE <> NEW.DOC_DATE or 
       OLD.TRX_TYPE <> NEW.TRX_TYPE */
    (OLD.DEBTOR_ACCT <> NEW.DEBTOR_ACCT or 
     OLD.DOC_NO <> NEW.DOC_NO or 
     OLD.DOC_DATE <> NEW.DOC_DATE or 
     OLD.TRX_TYPE <> NEW.TRX_TYPE) THEN
  BEGIN
    update AR_INVOICE_DT
      set
        /*  AR_INVOICE_DT.DEBTOR_ACCT = NEW.DEBTOR_ACCT,
            AR_INVOICE_DT.DOC_NO = NEW.DOC_NO,
            AR_INVOICE_DT.DOC_DATE = NEW.DOC_DATE,
            AR_INVOICE_DT.TRX_TYPE = NEW.TRX_TYPE */
        AR_INVOICE_DT.DEBTOR_ACCT = NEW.DEBTOR_ACCT,
        AR_INVOICE_DT.DOC_NO = NEW.DOC_NO,
        AR_INVOICE_DT.DOC_DATE = NEW.DOC_DATE,
        AR_INVOICE_DT.TRX_TYPE = NEW.TRX_TYPE
      where
        /*  AR_INVOICE_DT.DEBTOR_ACCT = OLD.DEBTOR_ACCT and
            AR_INVOICE_DT.DOC_NO = OLD.DOC_NO and
            AR_INVOICE_DT.DOC_DATE = OLD.DOC_DATE and
            AR_INVOICE_DT.TRX_TYPE = OLD.TRX_TYPE */
        AR_INVOICE_DT.DEBTOR_ACCT = OLD.DEBTOR_ACCT and
        AR_INVOICE_DT.DOC_NO = OLD.DOC_NO and
        AR_INVOICE_DT.DOC_DATE = OLD.DOC_DATE and
        AR_INVOICE_DT.TRX_TYPE = OLD.TRX_TYPE;
  END


  /* ERwin Builtin Mon Nov 11 16:42:53 2002 */
END
^


SET TERM ; ^



/******************************************************************************/
/****                              Privileges                              ****/
/******************************************************************************/


/* Privileges of users */
GRANT ALL ON AR_INVOICE_HD TO REPL WITH GRANT OPTION;

/* Privileges of triggers */
GRANT SELECT ON AR_INVOICE_HD TO TRIGGER IC_MAT_STK_DT_LINK_AD0;